SET ECHO ON
SET TIMING ON
SET FEEDBACK ON

SPOOL &1;

--============================================
-- 		ESPECIALIZACION BI & BIG DATA
--============================================

-- CARGA DE TABLA HM_CLIENTE

TRUNCATE TABLE HM_CLIENTE;

INSERT INTO HM_CLIENTE
(
	CODMES						,
	TIPREGISTRO					,
	CODSBSCLIENTE				,
	FECREPORTE					,
	TIPDOCEMPRESA				,
	RUC							,
	TIPDOCIDENTIDAD				,
	DOCIDENTIDAD				,
	TIPPERSONA					,
	TIPEMPRESA					,
	CANTEMPRESA					,
	DEUDACALIFNORMAL			,
	DEUDACALIFCPP				,
	DEUDACALIFDEFICIENTE		,
	DEUDACALIFDUDOSO			,
	DEUDACALIFPERDIDA			,
	DEUDACALIFCLIENTE			,
	CLASIFDEUDACLIENTE			,
	RAZSOCOAP					,
	APMATERNO					,
	APCASADO					,
	NOMBRE1						,
	NOMBRE2				
)
SELECT 
	CODMES						,	
	2							,		
	TO_NUMBER(CODSBSCLIENTE)	,		
	FECREPORTE				    ,
	TIPDOCEMPRESA			    ,
	RUC						    ,
	TIPDOCIDENTIDAD			    ,
	DOCIDENTIDAD			    ,
	TIPPERSONA				    ,
	TIPEMPRESA				    ,
	CANTEMPRESA				    ,
	TO_NUMBER(REPLACE(DEUDACALIFNORMAL, '.', ','))		,	
	TO_NUMBER(REPLACE(DEUDACALIFCPP, '.', ','))			,	
	TO_NUMBER(REPLACE(DEUDACALIFDEFICIENTE, '.', ','))	,	
	TO_NUMBER(REPLACE(DEUDACALIFDUDOSO, '.', ','))		,	
	TO_NUMBER(REPLACE(DEUDACALIFPERDIDA, '.', ','))	    ,
	CASE 
	WHEN TO_NUMBER(REPLACE(DEUDACALIFNORMAL, '.', ',')) > TO_NUMBER(REPLACE(DEUDACALIFCPP, '.', ',')) AND 
		 TO_NUMBER(REPLACE(DEUDACALIFNORMAL, '.', ',')) > TO_NUMBER(REPLACE(DEUDACALIFDEFICIENTE, '.', ',')) AND
		 TO_NUMBER(REPLACE(DEUDACALIFNORMAL, '.', ',')) > TO_NUMBER(REPLACE(DEUDACALIFDUDOSO, '.', ',')) AND
		 TO_NUMBER(REPLACE(DEUDACALIFNORMAL, '.', ',')) > TO_NUMBER(REPLACE(DEUDACALIFPERDIDA, '.', ',')) THEN TO_NUMBER(REPLACE(DEUDACALIFNORMAL, '.', ','))
    WHEN TO_NUMBER(REPLACE(DEUDACALIFCPP, '.', ',')) > TO_NUMBER(REPLACE(DEUDACALIFNORMAL, '.', ',')) AND 
		 TO_NUMBER(REPLACE(DEUDACALIFCPP, '.', ',')) > TO_NUMBER(REPLACE(DEUDACALIFDEFICIENTE, '.', ',')) AND
		 TO_NUMBER(REPLACE(DEUDACALIFCPP, '.', ',')) > TO_NUMBER(REPLACE(DEUDACALIFDUDOSO, '.', ',')) AND
		 TO_NUMBER(REPLACE(DEUDACALIFCPP, '.', ',')) > TO_NUMBER(REPLACE(DEUDACALIFPERDIDA, '.', ',')) THEN TO_NUMBER(REPLACE(DEUDACALIFCPP, '.', ','))
	WHEN TO_NUMBER(REPLACE(DEUDACALIFDEFICIENTE, '.', ',')) > TO_NUMBER(REPLACE(DEUDACALIFNORMAL, '.', ',')) AND 
		 TO_NUMBER(REPLACE(DEUDACALIFDEFICIENTE, '.', ',')) > TO_NUMBER(REPLACE(DEUDACALIFCPP, '.', ',')) AND
		 TO_NUMBER(REPLACE(DEUDACALIFDEFICIENTE, '.', ',')) > TO_NUMBER(REPLACE(DEUDACALIFDUDOSO, '.', ',')) AND
		 TO_NUMBER(REPLACE(DEUDACALIFDEFICIENTE, '.', ',')) > TO_NUMBER(REPLACE(DEUDACALIFPERDIDA, '.', ',')) THEN TO_NUMBER(REPLACE(DEUDACALIFDEFICIENTE, '.', ','))
	WHEN TO_NUMBER(REPLACE(DEUDACALIFDUDOSO, '.', ',')) > TO_NUMBER(REPLACE(DEUDACALIFNORMAL, '.', ',')) AND 
		 TO_NUMBER(REPLACE(DEUDACALIFDUDOSO, '.', ',')) > TO_NUMBER(REPLACE(DEUDACALIFCPP, '.', ',')) AND
		 TO_NUMBER(REPLACE(DEUDACALIFDUDOSO, '.', ',')) > TO_NUMBER(REPLACE(DEUDACALIFDEFICIENTE, '.', ',')) AND
		 TO_NUMBER(REPLACE(DEUDACALIFDUDOSO, '.', ',')) > TO_NUMBER(REPLACE(DEUDACALIFPERDIDA, '.', ',')) THEN TO_NUMBER(REPLACE(DEUDACALIFDUDOSO, '.', ','))
	WHEN TO_NUMBER(REPLACE(DEUDACALIFPERDIDA, '.', ',')) > TO_NUMBER(REPLACE(DEUDACALIFNORMAL, '.', ',')) AND 
		 TO_NUMBER(REPLACE(DEUDACALIFPERDIDA, '.', ',')) > TO_NUMBER(REPLACE(DEUDACALIFCPP, '.', ',')) AND
		 TO_NUMBER(REPLACE(DEUDACALIFPERDIDA, '.', ',')) > TO_NUMBER(REPLACE(DEUDACALIFDEFICIENTE, '.', ',')) AND
		 TO_NUMBER(REPLACE(DEUDACALIFPERDIDA, '.', ',')) > TO_NUMBER(REPLACE(DEUDACALIFDUDOSO, '.', ',')) THEN TO_NUMBER(REPLACE(DEUDACALIFPERDIDA, '.', ','))
	WHEN TO_NUMBER(REPLACE(DEUDACALIFPERDIDA, '.', ',')) = 0 AND 
		 TO_NUMBER(REPLACE(DEUDACALIFPERDIDA, '.', ',')) = 0 AND
		 TO_NUMBER(REPLACE(DEUDACALIFPERDIDA, '.', ',')) = 0 AND
		 TO_NUMBER(REPLACE(DEUDACALIFPERDIDA, '.', ',')) = 0 THEN TO_NUMBER(REPLACE(DEUDACALIFNORMAL, '.', ','))
	END DEUDACALIFCLIENTE	,
	CASE 
	WHEN TO_NUMBER(REPLACE(DEUDACALIFNORMAL, '.', ',')) > TO_NUMBER(REPLACE(DEUDACALIFCPP, '.', ',')) AND 
		 TO_NUMBER(REPLACE(DEUDACALIFNORMAL, '.', ',')) > TO_NUMBER(REPLACE(DEUDACALIFDEFICIENTE, '.', ',')) AND
		 TO_NUMBER(REPLACE(DEUDACALIFNORMAL, '.', ',')) > TO_NUMBER(REPLACE(DEUDACALIFDUDOSO, '.', ',')) AND
		 TO_NUMBER(REPLACE(DEUDACALIFNORMAL, '.', ',')) > TO_NUMBER(REPLACE(DEUDACALIFPERDIDA, '.', ',')) THEN 0
    WHEN TO_NUMBER(REPLACE(DEUDACALIFCPP, '.', ',')) > TO_NUMBER(REPLACE(DEUDACALIFNORMAL, '.', ',')) AND 
		 TO_NUMBER(REPLACE(DEUDACALIFCPP, '.', ',')) > TO_NUMBER(REPLACE(DEUDACALIFDEFICIENTE, '.', ',')) AND
		 TO_NUMBER(REPLACE(DEUDACALIFCPP, '.', ',')) > TO_NUMBER(REPLACE(DEUDACALIFDUDOSO, '.', ',')) AND
		 TO_NUMBER(REPLACE(DEUDACALIFCPP, '.', ',')) > TO_NUMBER(REPLACE(DEUDACALIFPERDIDA, '.', ',')) THEN 1
	WHEN TO_NUMBER(REPLACE(DEUDACALIFDEFICIENTE, '.', ',')) > TO_NUMBER(REPLACE(DEUDACALIFNORMAL, '.', ',')) AND 
		 TO_NUMBER(REPLACE(DEUDACALIFDEFICIENTE, '.', ',')) > TO_NUMBER(REPLACE(DEUDACALIFCPP, '.', ',')) AND
		 TO_NUMBER(REPLACE(DEUDACALIFDEFICIENTE, '.', ',')) > TO_NUMBER(REPLACE(DEUDACALIFDUDOSO, '.', ',')) AND
		 TO_NUMBER(REPLACE(DEUDACALIFDEFICIENTE, '.', ',')) > TO_NUMBER(REPLACE(DEUDACALIFPERDIDA, '.', ',')) THEN 2
	WHEN TO_NUMBER(REPLACE(DEUDACALIFDUDOSO, '.', ',')) > TO_NUMBER(REPLACE(DEUDACALIFNORMAL, '.', ',')) AND 
		 TO_NUMBER(REPLACE(DEUDACALIFDUDOSO, '.', ',')) > TO_NUMBER(REPLACE(DEUDACALIFCPP, '.', ',')) AND
		 TO_NUMBER(REPLACE(DEUDACALIFDUDOSO, '.', ',')) > TO_NUMBER(REPLACE(DEUDACALIFDEFICIENTE, '.', ',')) AND
		 TO_NUMBER(REPLACE(DEUDACALIFDUDOSO, '.', ',')) > TO_NUMBER(REPLACE(DEUDACALIFPERDIDA, '.', ',')) THEN 3
	WHEN TO_NUMBER(REPLACE(DEUDACALIFPERDIDA, '.', ',')) > TO_NUMBER(REPLACE(DEUDACALIFNORMAL, '.', ',')) AND 
		 TO_NUMBER(REPLACE(DEUDACALIFPERDIDA, '.', ',')) > TO_NUMBER(REPLACE(DEUDACALIFCPP, '.', ',')) AND
		 TO_NUMBER(REPLACE(DEUDACALIFPERDIDA, '.', ',')) > TO_NUMBER(REPLACE(DEUDACALIFDEFICIENTE, '.', ',')) AND
		 TO_NUMBER(REPLACE(DEUDACALIFPERDIDA, '.', ',')) > TO_NUMBER(REPLACE(DEUDACALIFDUDOSO, '.', ',')) THEN 4
	WHEN TO_NUMBER(REPLACE(DEUDACALIFPERDIDA, '.', ',')) = 0 AND 
		 TO_NUMBER(REPLACE(DEUDACALIFPERDIDA, '.', ',')) = 0 AND
		 TO_NUMBER(REPLACE(DEUDACALIFPERDIDA, '.', ',')) = 0 AND
		 TO_NUMBER(REPLACE(DEUDACALIFPERDIDA, '.', ',')) = 0 THEN 0
	END CLASIFDEUDACLIENTE	,
	RAZSOCOAP				,		
	APMATERNO				,
	APCASADO				,
	NOMBRE1					,
	NOMBRE2					
FROM TMP_CLIENTE;

COMMIT;

DISCONNECT;
EXIT;